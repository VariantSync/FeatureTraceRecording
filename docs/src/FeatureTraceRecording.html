<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{- |
Description: Data types and interfaces for feature trace recording.
License: GNU LGPLv3
Maintainer: paul.bittner@uni-ulm.de

Data types and framework for feature trace recording.
This module provides functions to run feature trace recording as well as the datatypes required to
implement custom feature trace recording algorithms (i.e., variations of Algorithm 1 in the paper)
and functions (i.e., supporting new edit types or adapting/replacing the default recording functions
for different use cases).
-}</span><span>
</span><span id="line-12"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">FeatureTraceRecording</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Edits.html"><span class="hs-identifier">Edits</span></a></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="AST.html"><span class="hs-identifier">AST</span></a></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Feature.html"><span class="hs-identifier">Feature</span></a></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="FeatureTrace.html"><span class="hs-identifier">FeatureTrace</span></a></span><span>
</span><span id="line-18"></span><span>
</span><span id="line-19"></span><span class="hs-comment">-- | The feature context is a nullable propositional formula over features to tag edits to source code with the feature that was edited.</span><span>
</span><span id="line-20"></span><span class="hs-keyword">type</span><span> </span><span id="FeatureContext"><span class="annot"><a href="FeatureTraceRecording.html#FeatureContext"><span class="hs-identifier hs-var">FeatureContext</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Feature.html#FeatureFormula"><span class="hs-identifier hs-type">FeatureFormula</span></a></span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span class="hs-comment">{- |
Encapsulates an edit that was made under a given 'FeatureContext'.
This relation might be established upon commit to version control or via IDE interaction (see Section 4.1 in the paper).
-}</span><span>
</span><span id="line-26"></span><span class="hs-keyword">type</span><span> </span><span id="RecordedEdit"><span class="annot"><a href="FeatureTraceRecording.html#RecordedEdit"><span class="hs-identifier hs-var">RecordedEdit</span></a></span></span><span> </span><span id="local-6989586621679094453"><span class="annot"><a href="#local-6989586621679094453"><span class="hs-identifier hs-type">g</span></a></span></span><span> </span><span id="local-6989586621679094452"><span class="annot"><a href="#local-6989586621679094452"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Edits.html#Edit"><span class="hs-identifier hs-type">Edit</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094453"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094452"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="FeatureTraceRecording.html#FeatureContext"><span class="hs-identifier hs-type">FeatureContext</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span>
</span><span id="line-28"></span><span class="hs-comment">{- |
We call a list of edits a change 'History'.
-}</span><span>
</span><span id="line-31"></span><span class="hs-keyword">type</span><span> </span><span id="History"><span class="annot"><a href="FeatureTraceRecording.html#History"><span class="hs-identifier hs-var">History</span></a></span></span><span> </span><span id="local-6989586621679094451"><span class="annot"><a href="#local-6989586621679094451"><span class="hs-identifier hs-type">g</span></a></span></span><span> </span><span id="local-6989586621679094450"><span class="annot"><a href="#local-6989586621679094450"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="FeatureTraceRecording.html#RecordedEdit"><span class="hs-identifier hs-type">RecordedEdit</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094451"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094450"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span class="hs-comment">{- |
We denote the state of a software system at any point in time as a 'Version'.
We describe a version by the software artefacts in terms of an 'AST' and the according 'FeatureTrace's we have at that version.
-}</span><span>
</span><span id="line-37"></span><span class="hs-keyword">type</span><span> </span><span id="Version"><span class="annot"><a href="FeatureTraceRecording.html#Version"><span class="hs-identifier hs-var">Version</span></a></span></span><span> </span><span id="local-6989586621679094449"><span class="annot"><a href="#local-6989586621679094449"><span class="hs-identifier hs-type">g</span></a></span></span><span> </span><span id="local-6989586621679094448"><span class="annot"><a href="#local-6989586621679094448"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="FeatureTrace.html#FeatureTrace"><span class="hs-identifier hs-type">FeatureTrace</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094449"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094448"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="AST.html#AST"><span class="hs-identifier hs-type">AST</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094449"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094448"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span class="hs-comment">{- |
Type of recording functions for individual edit types.
In the paper, these edits are referred to as R_ins, R_del, R_mov, and R_up.
Instead of passing the delta, we give the entire edit as input to the function from which the delta can be calculated.
-}</span><span>
</span><span id="line-44"></span><span class="hs-keyword">type</span><span> </span><span id="RecordingFunction"><span class="annot"><a href="FeatureTraceRecording.html#RecordingFunction"><span class="hs-identifier hs-var">RecordingFunction</span></a></span></span><span> </span><span id="local-6989586621679094446"><span class="annot"><a href="#local-6989586621679094446"><span class="hs-identifier hs-type">g</span></a></span></span><span> </span><span id="local-6989586621679094445"><span class="annot"><a href="#local-6989586621679094445"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="FeatureTraceRecording.html#RecordedEdit"><span class="hs-identifier hs-type">RecordedEdit</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094446"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094445"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="FeatureTraceRecording.html#Version"><span class="hs-identifier hs-type">Version</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094446"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094445"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="FeatureTrace.html#FeatureTrace"><span class="hs-identifier hs-type">FeatureTrace</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094446"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094445"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span class="hs-comment">{- |
Abstraction over Algorithm 1 in the paper.
For different use cases and to prevent future errors, feature trace recording is configurable.
In a framework-like manner, it gives us an implementation for a recording function identified by edit types.
-}</span><span>
</span><span id="line-51"></span><span class="hs-keyword">type</span><span> </span><span id="FeatureTraceRecording"><span class="annot"><a href="FeatureTraceRecording.html#FeatureTraceRecording"><span class="hs-identifier hs-var">FeatureTraceRecording</span></a></span></span><span> </span><span id="local-6989586621679094444"><span class="annot"><a href="#local-6989586621679094444"><span class="hs-identifier hs-type">g</span></a></span></span><span> </span><span id="local-6989586621679094443"><span class="annot"><a href="#local-6989586621679094443"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Edits.html#EditType"><span class="hs-identifier hs-type">EditType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="FeatureTraceRecording.html#RecordingFunction"><span class="hs-identifier hs-type">RecordingFunction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094444"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094443"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span class="hs-comment">{- |
Runs the given 'FeatureTraceRecording' implementation starting at the given 'Version'.
All edits in the given 'History' will be applied to the given version yielding the new version after that history.
-}</span><span>
</span><span id="line-57"></span><span id="local-6989586621679094441"><span id="local-6989586621679094442"><span class="annot"><a href="FeatureTraceRecording.html#runFTR"><span class="hs-identifier hs-type">runFTR</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679094442"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679094442"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="FeatureTraceRecording.html#FeatureTraceRecording"><span class="hs-identifier hs-type">FeatureTraceRecording</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094441"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094442"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="FeatureTraceRecording.html#Version"><span class="hs-identifier hs-type">Version</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094441"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094442"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="FeatureTraceRecording.html#History"><span class="hs-identifier hs-type">History</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094441"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094442"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="FeatureTraceRecording.html#Version"><span class="hs-identifier hs-type">Version</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094441"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094442"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-58"></span><span id="runFTR"><span class="annot"><span class="annottext">runFTR :: FeatureTraceRecording g a
-&gt; Version g a -&gt; History g a -&gt; Version g a
</span><a href="FeatureTraceRecording.html#runFTR"><span class="hs-identifier hs-var hs-var">runFTR</span></a></span></span><span> </span><span id="local-6989586621679094439"><span class="annot"><span class="annottext">ftr :: FeatureTraceRecording g a
</span><a href="#local-6989586621679094439"><span class="hs-identifier hs-var">ftr</span></a></span></span><span> </span><span id="local-6989586621679094438"><span class="annot"><span class="annottext">startVersion :: Version g a
</span><a href="#local-6989586621679094438"><span class="hs-identifier hs-var">startVersion</span></a></span></span><span> </span><span id="local-6989586621679094437"><span class="annot"><span class="annottext">history :: History g a
</span><a href="#local-6989586621679094437"><span class="hs-identifier hs-var">history</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Version g a] -&gt; Version g a
forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">last</span></span><span> </span><span class="annot"><span class="annottext">([Version g a] -&gt; Version g a) -&gt; [Version g a] -&gt; Version g a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FeatureTraceRecording g a
-&gt; Version g a -&gt; History g a -&gt; [Version g a]
forall a g.
(Show a, Eq a) =&gt;
FeatureTraceRecording g a
-&gt; Version g a -&gt; History g a -&gt; [Version g a]
</span><a href="FeatureTraceRecording.html#runFTRWithIntermediateSteps"><span class="hs-identifier hs-var">runFTRWithIntermediateSteps</span></a></span><span> </span><span class="annot"><span class="annottext">FeatureTraceRecording g a
</span><a href="#local-6989586621679094439"><span class="hs-identifier hs-var">ftr</span></a></span><span> </span><span class="annot"><span class="annottext">Version g a
</span><a href="#local-6989586621679094438"><span class="hs-identifier hs-var">startVersion</span></a></span><span> </span><span class="annot"><span class="annottext">History g a
</span><a href="#local-6989586621679094437"><span class="hs-identifier hs-var">history</span></a></span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span class="hs-comment">{- |
Similar to 'runFTR' but also returns all intermediate results.
-}</span><span>
</span><span id="line-63"></span><span id="local-6989586621679094467"><span id="local-6989586621679094468"><span class="annot"><a href="FeatureTraceRecording.html#runFTRWithIntermediateSteps"><span class="hs-identifier hs-type">runFTRWithIntermediateSteps</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679094468"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679094468"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="FeatureTraceRecording.html#FeatureTraceRecording"><span class="hs-identifier hs-type">FeatureTraceRecording</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094467"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094468"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="FeatureTraceRecording.html#Version"><span class="hs-identifier hs-type">Version</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094467"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094468"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="FeatureTraceRecording.html#History"><span class="hs-identifier hs-type">History</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094467"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094468"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="FeatureTraceRecording.html#Version"><span class="hs-identifier hs-type">Version</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094467"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094468"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-64"></span><span id="runFTRWithIntermediateSteps"><span class="annot"><span class="annottext">runFTRWithIntermediateSteps :: FeatureTraceRecording g a
-&gt; Version g a -&gt; History g a -&gt; [Version g a]
</span><a href="FeatureTraceRecording.html#runFTRWithIntermediateSteps"><span class="hs-identifier hs-var hs-var">runFTRWithIntermediateSteps</span></a></span></span><span> </span><span id="local-6989586621679094434"><span class="annot"><span class="annottext">ftr :: FeatureTraceRecording g a
</span><a href="#local-6989586621679094434"><span class="hs-identifier hs-var">ftr</span></a></span></span><span> </span><span id="local-6989586621679094433"><span class="annot"><span class="annottext">startVersion :: Version g a
</span><a href="#local-6989586621679094433"><span class="hs-identifier hs-var">startVersion</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Version g a -&gt; (Edit g a, FeatureContext) -&gt; Version g a)
-&gt; Version g a -&gt; History g a -&gt; [Version g a]
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">scanl</span></span><span> </span><span class="annot"><span class="annottext">Version g a -&gt; (Edit g a, FeatureContext) -&gt; Version g a
</span><a href="#local-6989586621679094431"><span class="hs-identifier hs-var">record</span></a></span><span> </span><span class="annot"><span class="annottext">Version g a
</span><a href="#local-6989586621679094433"><span class="hs-identifier hs-var">startVersion</span></a></span><span>
</span><span id="line-65"></span><span>    </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679094431"><span class="annot"><span class="annottext">record :: Version g a -&gt; (Edit g a, FeatureContext) -&gt; Version g a
</span><a href="#local-6989586621679094431"><span class="hs-identifier hs-var hs-var">record</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679094430"><span class="annot"><span class="annottext">f_old :: FeatureTrace g a
</span><a href="#local-6989586621679094430"><span class="hs-identifier hs-var">f_old</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679094429"><span class="annot"><span class="annottext">t_old :: AST g a
</span><a href="#local-6989586621679094429"><span class="hs-identifier hs-var">t_old</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679094428"><span class="annot"><span class="annottext">recordedEdit :: (Edit g a, FeatureContext)
</span><a href="#local-6989586621679094428"><span class="hs-identifier hs-var">recordedEdit</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621679094427"><span class="annot"><span class="annottext">edit :: Edit g a
</span><a href="#local-6989586621679094427"><span class="hs-identifier hs-var">edit</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FeatureTraceRecording g a
</span><a href="#local-6989586621679094434"><span class="hs-identifier hs-var">ftr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Edit g a -&gt; EditType
forall g a. Edit g a -&gt; EditType
</span><a href="Edits.html#edittype"><span class="hs-identifier hs-var hs-var">edittype</span></a></span><span> </span><span class="annot"><span class="annottext">Edit g a
</span><a href="#local-6989586621679094427"><span class="hs-identifier hs-var">edit</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Edit g a, FeatureContext)
</span><a href="#local-6989586621679094428"><span class="hs-identifier hs-var">recordedEdit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FeatureTrace g a
</span><a href="#local-6989586621679094430"><span class="hs-identifier hs-var">f_old</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AST g a
</span><a href="#local-6989586621679094429"><span class="hs-identifier hs-var">t_old</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Edit g a -&gt; AST g a -&gt; AST g a
forall g a. Edit g a -&gt; AST g a -&gt; AST g a
</span><a href="Edits.html#run"><span class="hs-identifier hs-var hs-var">run</span></a></span><span> </span><span class="annot"><span class="annottext">Edit g a
</span><a href="#local-6989586621679094427"><span class="hs-identifier hs-var">edit</span></a></span><span> </span><span class="annot"><span class="annottext">AST g a
</span><a href="#local-6989586621679094429"><span class="hs-identifier hs-var">t_old</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-67"></span></pre></body></html>