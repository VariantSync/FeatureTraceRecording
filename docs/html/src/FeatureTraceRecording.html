<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">FeatureTraceRecording</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Edits.html"><span class="hs-identifier">Edits</span></a></span><span>
</span><span id="line-4"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="AST.html"><span class="hs-identifier">AST</span></a></span><span>
</span><span id="line-5"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Feature.html"><span class="hs-identifier">Feature</span></a></span><span>
</span><span id="line-6"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="FeatureTrace.html"><span class="hs-identifier">FeatureTrace</span></a></span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span class="hs-keyword">type</span><span> </span><span id="FeatureContext"><span class="annot"><a href="FeatureTraceRecording.html#FeatureContext"><span class="hs-identifier hs-var">FeatureContext</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Feature.html#FeatureFormula"><span class="hs-identifier hs-type">FeatureFormula</span></a></span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="hs-comment">{-
Encapsulates an edit that was recorded under a given feature context.
This might happen via IDE interaction or diffing techniques.
-}</span><span>
</span><span id="line-14"></span><span class="hs-keyword">type</span><span> </span><span id="RecordedEdit"><span class="annot"><a href="FeatureTraceRecording.html#RecordedEdit"><span class="hs-identifier hs-var">RecordedEdit</span></a></span></span><span> </span><span id="local-6989586621679094749"><span class="annot"><a href="#local-6989586621679094749"><span class="hs-identifier hs-type">g</span></a></span></span><span> </span><span id="local-6989586621679094748"><span class="annot"><a href="#local-6989586621679094748"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Edits.html#Edit"><span class="hs-identifier hs-type">Edit</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094749"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094748"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="FeatureTraceRecording.html#FeatureContext"><span class="hs-identifier hs-type">FeatureContext</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span class="hs-keyword">type</span><span> </span><span id="History"><span class="annot"><a href="FeatureTraceRecording.html#History"><span class="hs-identifier hs-var">History</span></a></span></span><span> </span><span id="local-6989586621679094747"><span class="annot"><a href="#local-6989586621679094747"><span class="hs-identifier hs-type">g</span></a></span></span><span> </span><span id="local-6989586621679094746"><span class="annot"><a href="#local-6989586621679094746"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="FeatureTraceRecording.html#RecordedEdit"><span class="hs-identifier hs-type">RecordedEdit</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094747"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094746"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span class="hs-comment">{-
We denote the state of a software system at any point in time as a Version.
We describe a version by the software artefacts in terms of an AST and the according feature traces we have at that version.
-}</span><span>
</span><span id="line-21"></span><span class="hs-keyword">type</span><span> </span><span id="Version"><span class="annot"><a href="FeatureTraceRecording.html#Version"><span class="hs-identifier hs-var">Version</span></a></span></span><span> </span><span id="local-6989586621679094745"><span class="annot"><a href="#local-6989586621679094745"><span class="hs-identifier hs-type">g</span></a></span></span><span> </span><span id="local-6989586621679094744"><span class="annot"><a href="#local-6989586621679094744"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="FeatureTrace.html#FeatureTrace"><span class="hs-identifier hs-type">FeatureTrace</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094745"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094744"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="AST.html#AST"><span class="hs-identifier hs-type">AST</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094745"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094744"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-comment">{-
Type for the recording functions for individual edit types.
In the paper, these edits are referred to as R_ins, R_del, R_mov, and R_up.
Instead of passing the delta, we give the entire edit as input to the function from which the delta can be calculated.
-}</span><span>
</span><span id="line-28"></span><span class="hs-keyword">type</span><span> </span><span id="RecordingFunction"><span class="annot"><a href="FeatureTraceRecording.html#RecordingFunction"><span class="hs-identifier hs-var">RecordingFunction</span></a></span></span><span> </span><span id="local-6989586621679094742"><span class="annot"><a href="#local-6989586621679094742"><span class="hs-identifier hs-type">g</span></a></span></span><span> </span><span id="local-6989586621679094741"><span class="annot"><a href="#local-6989586621679094741"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="FeatureTraceRecording.html#RecordedEdit"><span class="hs-identifier hs-type">RecordedEdit</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094742"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094741"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="FeatureTraceRecording.html#Version"><span class="hs-identifier hs-type">Version</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094742"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094741"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="FeatureTrace.html#FeatureTrace"><span class="hs-identifier hs-type">FeatureTrace</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094742"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094741"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span class="hs-comment">{-
Abstraction over Algorithm 1 in the paper.
For different use cases and to prevent future errors, feature trace recording is configurable.
In a framework-like manner, it gives us an implementation for a recording function identified by edit types.
-}</span><span>
</span><span id="line-35"></span><span class="hs-keyword">type</span><span> </span><span id="FeatureTraceRecording"><span class="annot"><a href="FeatureTraceRecording.html#FeatureTraceRecording"><span class="hs-identifier hs-var">FeatureTraceRecording</span></a></span></span><span> </span><span id="local-6989586621679094740"><span class="annot"><a href="#local-6989586621679094740"><span class="hs-identifier hs-type">g</span></a></span></span><span> </span><span id="local-6989586621679094739"><span class="annot"><a href="#local-6989586621679094739"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Edits.html#EditType"><span class="hs-identifier hs-type">EditType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="FeatureTraceRecording.html#RecordingFunction"><span class="hs-identifier hs-type">RecordingFunction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094740"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094739"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span class="hs-comment">{-
Runs the given feature trace recording implementation starting at the given version.
All edits in the given history will be applied to the given version yielding the new version after that history.
-}</span><span>
</span><span id="line-41"></span><span id="local-6989586621679094737"><span id="local-6989586621679094738"><span class="annot"><a href="FeatureTraceRecording.html#runFTR"><span class="hs-identifier hs-type">runFTR</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679094738"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679094738"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="FeatureTraceRecording.html#FeatureTraceRecording"><span class="hs-identifier hs-type">FeatureTraceRecording</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094737"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094738"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="FeatureTraceRecording.html#Version"><span class="hs-identifier hs-type">Version</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094737"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094738"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="FeatureTraceRecording.html#History"><span class="hs-identifier hs-type">History</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094737"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094738"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="FeatureTraceRecording.html#Version"><span class="hs-identifier hs-type">Version</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094737"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094738"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-42"></span><span id="runFTR"><span class="annot"><span class="annottext">runFTR :: FeatureTraceRecording g a
-&gt; Version g a -&gt; History g a -&gt; Version g a
</span><a href="FeatureTraceRecording.html#runFTR"><span class="hs-identifier hs-var hs-var">runFTR</span></a></span></span><span> </span><span id="local-6989586621679094735"><span class="annot"><span class="annottext">ftr :: FeatureTraceRecording g a
</span><a href="#local-6989586621679094735"><span class="hs-identifier hs-var">ftr</span></a></span></span><span> </span><span id="local-6989586621679094734"><span class="annot"><span class="annottext">startVersion :: Version g a
</span><a href="#local-6989586621679094734"><span class="hs-identifier hs-var">startVersion</span></a></span></span><span> </span><span id="local-6989586621679094733"><span class="annot"><span class="annottext">history :: History g a
</span><a href="#local-6989586621679094733"><span class="hs-identifier hs-var">history</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Version g a] -&gt; Version g a
forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">last</span></span><span> </span><span class="annot"><span class="annottext">([Version g a] -&gt; Version g a) -&gt; [Version g a] -&gt; Version g a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FeatureTraceRecording g a
-&gt; Version g a -&gt; History g a -&gt; [Version g a]
forall a g.
(Show a, Eq a) =&gt;
FeatureTraceRecording g a
-&gt; Version g a -&gt; History g a -&gt; [Version g a]
</span><a href="FeatureTraceRecording.html#runFTRWithIntermediateSteps"><span class="hs-identifier hs-var">runFTRWithIntermediateSteps</span></a></span><span> </span><span class="annot"><span class="annottext">FeatureTraceRecording g a
</span><a href="#local-6989586621679094735"><span class="hs-identifier hs-var">ftr</span></a></span><span> </span><span class="annot"><span class="annottext">Version g a
</span><a href="#local-6989586621679094734"><span class="hs-identifier hs-var">startVersion</span></a></span><span> </span><span class="annot"><span class="annottext">History g a
</span><a href="#local-6989586621679094733"><span class="hs-identifier hs-var">history</span></a></span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span class="hs-comment">{-
The same as runFTR but also returns all intermediate results.
-}</span><span>
</span><span id="line-47"></span><span id="local-6989586621679094763"><span id="local-6989586621679094764"><span class="annot"><a href="FeatureTraceRecording.html#runFTRWithIntermediateSteps"><span class="hs-identifier hs-type">runFTRWithIntermediateSteps</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679094764"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679094764"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="FeatureTraceRecording.html#FeatureTraceRecording"><span class="hs-identifier hs-type">FeatureTraceRecording</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094763"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094764"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="FeatureTraceRecording.html#Version"><span class="hs-identifier hs-type">Version</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094763"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094764"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="FeatureTraceRecording.html#History"><span class="hs-identifier hs-type">History</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094763"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094764"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="FeatureTraceRecording.html#Version"><span class="hs-identifier hs-type">Version</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094763"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679094764"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-48"></span><span id="runFTRWithIntermediateSteps"><span class="annot"><span class="annottext">runFTRWithIntermediateSteps :: FeatureTraceRecording g a
-&gt; Version g a -&gt; History g a -&gt; [Version g a]
</span><a href="FeatureTraceRecording.html#runFTRWithIntermediateSteps"><span class="hs-identifier hs-var hs-var">runFTRWithIntermediateSteps</span></a></span></span><span> </span><span id="local-6989586621679094730"><span class="annot"><span class="annottext">ftr :: FeatureTraceRecording g a
</span><a href="#local-6989586621679094730"><span class="hs-identifier hs-var">ftr</span></a></span></span><span> </span><span id="local-6989586621679094729"><span class="annot"><span class="annottext">startVersion :: Version g a
</span><a href="#local-6989586621679094729"><span class="hs-identifier hs-var">startVersion</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Version g a -&gt; (Edit g a, FeatureContext) -&gt; Version g a)
-&gt; Version g a -&gt; History g a -&gt; [Version g a]
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">scanl</span></span><span> </span><span class="annot"><span class="annottext">Version g a -&gt; (Edit g a, FeatureContext) -&gt; Version g a
</span><a href="#local-6989586621679094727"><span class="hs-identifier hs-var">record</span></a></span><span> </span><span class="annot"><span class="annottext">Version g a
</span><a href="#local-6989586621679094729"><span class="hs-identifier hs-var">startVersion</span></a></span><span>
</span><span id="line-49"></span><span>    </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679094727"><span class="annot"><span class="annottext">record :: Version g a -&gt; (Edit g a, FeatureContext) -&gt; Version g a
</span><a href="#local-6989586621679094727"><span class="hs-identifier hs-var hs-var">record</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679094726"><span class="annot"><span class="annottext">f_old :: FeatureTrace g a
</span><a href="#local-6989586621679094726"><span class="hs-identifier hs-var">f_old</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679094725"><span class="annot"><span class="annottext">t_old :: AST g a
</span><a href="#local-6989586621679094725"><span class="hs-identifier hs-var">t_old</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679094724"><span class="annot"><span class="annottext">recordedEdit :: (Edit g a, FeatureContext)
</span><a href="#local-6989586621679094724"><span class="hs-identifier hs-var">recordedEdit</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621679094723"><span class="annot"><span class="annottext">edit :: Edit g a
</span><a href="#local-6989586621679094723"><span class="hs-identifier hs-var">edit</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FeatureTraceRecording g a
</span><a href="#local-6989586621679094730"><span class="hs-identifier hs-var">ftr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Edit g a -&gt; EditType
forall g a. Edit g a -&gt; EditType
</span><a href="Edits.html#edittype"><span class="hs-identifier hs-var hs-var">edittype</span></a></span><span> </span><span class="annot"><span class="annottext">Edit g a
</span><a href="#local-6989586621679094723"><span class="hs-identifier hs-var">edit</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Edit g a, FeatureContext)
</span><a href="#local-6989586621679094724"><span class="hs-identifier hs-var">recordedEdit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FeatureTrace g a
</span><a href="#local-6989586621679094726"><span class="hs-identifier hs-var">f_old</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AST g a
</span><a href="#local-6989586621679094725"><span class="hs-identifier hs-var">t_old</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Edit g a -&gt; AST g a -&gt; AST g a
forall g a. Edit g a -&gt; AST g a -&gt; AST g a
</span><a href="Edits.html#run"><span class="hs-identifier hs-var hs-var">run</span></a></span><span> </span><span class="annot"><span class="annottext">Edit g a
</span><a href="#local-6989586621679094723"><span class="hs-identifier hs-var">edit</span></a></span><span> </span><span class="annot"><span class="annottext">AST g a
</span><a href="#local-6989586621679094725"><span class="hs-identifier hs-var">t_old</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-51"></span></pre></body></html>